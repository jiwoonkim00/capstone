# WSL SSH 네트워크 구조 설명

## 네트워크 계층 구조

```
Mac (192.168.1.x)
    ↓ SSH 접속
Windows 호스트 (192.168.1.102)
    ↓ 포트 포워딩 (2222 → 22)
WSL (172.22.85.100:22)
```

## IP 주소 설명

### 1. WSL IP: `172.22.85.100`
- **타입**: 가상 네트워크 IP (NAT 네트워크)
- **접근 범위**: Windows 호스트 내부에서만 접근 가능
- **Mac에서 직접 접속**: ❌ 불가능
  - 이유: Mac은 이 IP 주소를 라우팅할 수 없음 (Windows 내부 네트워크)

### 2. Windows 호스트 IP: `192.168.1.102`
- **타입**: 실제 네트워크 IP (로컬 네트워크)
- **접근 범위**: 같은 네트워크(공유기/라우터)에 연결된 모든 장치에서 접근 가능
- **Mac에서 직접 접속**: ✅ 가능
  - 이유: Mac과 Windows가 같은 로컬 네트워크에 있음

## 왜 Windows 호스트 IP를 사용해야 하나?

### ❌ WSL IP 직접 접속이 안 되는 이유

```bash
# Mac에서 시도해도 작동하지 않음
ssh jiwoonkim@172.22.85.100  # ❌ 연결 실패
```

**이유:**
1. `172.22.85.100`은 Windows의 가상 네트워크 어댑터에 할당된 IP
2. 이 IP는 Windows 호스트 내부에서만 라우팅 가능
3. Mac은 이 IP를 인터넷/네트워크를 통해 찾을 수 없음

### ✅ Windows 호스트 IP + 포트 포워딩 방식

```bash
# Mac에서 작동하는 방법
ssh -p 2222 jiwoonkim@192.168.1.102  # ✅ 연결 성공
```

**작동 방식:**
1. Mac → `192.168.1.102:2222`로 SSH 접속
2. Windows가 포트 2222를 받아서 WSL의 `172.22.85.100:22`로 포워딩
3. WSL의 SSH 서버가 응답

## 포트 포워딩이 필요한 이유

Windows에서 실행한 명령어:

```powershell
netsh interface portproxy add v4tov4 \
    listenport=2222 \
    listenaddress=0.0.0.0 \
    connectport=22 \
    connectaddress=172.22.85.100
```

**의미:**
- Windows의 `2222` 포트로 들어오는 연결을
- WSL의 `172.22.85.100:22`로 전달

## 네트워크 흐름도

```
┌─────────────┐
│   Mac       │
│             │
│  SSH Client │
└──────┬──────┘
       │
       │ SSH 연결: ssh -p 2222 jiwoonkim@192.168.1.102
       │
       ▼
┌─────────────────────────────┐
│   Windows 호스트             │
│   IP: 192.168.1.102          │
│                              │
│   포트 포워딩:               │
│   2222 → 172.22.85.100:22   │
└──────┬──────────────────────┘
       │
       │ 포워딩된 연결
       │
       ▼
┌─────────────┐
│   WSL       │
│             │
│  IP:        │
│  172.22.85.100 │
│             │
│  SSH Server │
│  Port: 22   │
└─────────────┘
```

## 예외: WSL을 직접 노출하는 방법

WSL IP를 직접 사용하려면 (권장하지 않음):

1. **WSL 네트워크를 브리지 모드로 변경** (복잡하고 보안 위험)
2. **Windows 방화벽에서 WSL IP 직접 허용** (여전히 라우팅 문제)

하지만 일반적으로는 **포트 포워딩 방식이 가장 간단하고 안전**합니다.

## 요약

| 접속 방법 | 가능 여부 | 이유 |
|---------|---------|------|
| `ssh jiwoonkim@172.22.85.100` | ❌ | WSL IP는 Windows 내부 네트워크에만 존재 |
| `ssh -p 2222 jiwoonkim@192.168.1.102` | ✅ | Windows 호스트 IP로 접속 후 포트 포워딩 |

**결론**: VSCode SSH Config에서 `HostName`은 반드시 **Windows 호스트 IP (`192.168.1.102`)**를 사용해야 합니다!

